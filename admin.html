<!DOCTYPE html>
<html>
<head>
  <title>Walkathon Admin Panel</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f2f2f2; }
    input[type="number"] { width: 80px; }
    button { margin: 2px; }
  </style>
</head>
<body>
  <h2>Walkathon Admin Dashboard</h2>

  <div id="auth">
    <button onclick="signIn()">Sign in with Google</button>
    <p id="user"></p>
  </div>

  <div id="admin" style="display:none;">
    <h3>All Participants</h3>
    <table id="leaderboard">
      <tr>
        <th>Name</th>
        <th>Steps</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </table>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCmvm99Y813u-h0za23IsNQYtWjjk6q3iI",
      authDomain: "icxt-walkathon.firebaseapp.com",
      databaseURL: "https://icxt-walkathon-default-rtdb.firebaseio.com",
      projectId: "icxt-walkathon"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    function signIn() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).then(result => {
        const user = result.user;
        document.getElementById("user").textContent = `Signed in as ${user.email}`;
        if (user.email === "nitin1518@gmail.com") {
          document.getElementById("admin").style.display = "block";
          loadLeaderboard();
        } else {
          alert("Access denied. Only admin allowed.");
        }
      }).catch(err => alert("Login failed: " + err.message));
    }

    function loadLeaderboard() {
      db.ref("walkathon").once("value", snapshot => {
        const table = document.getElementById("leaderboard");
        table.innerHTML = `
          <tr>
            <th>Name</th>
            <th>Steps</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        `;

        snapshot.forEach(child => {
          const key = child.key;
          const data = child.val();
          const row = document.createElement("tr");

          row.innerHTML = `
            <td>${data.name || key}</td>
            <td>
              <input type="number" id="steps-${key}" value="${data.steps || 0}" />
            </td>
            <td>
              <input type="checkbox" id="enabled-${key}" ${data.enabled === false ? '' : 'checked'} />
            </td>
            <td>
              <button onclick="save('${key}')">üíæ Save</button>
              <button onclick="remove('${key}')">üóëÔ∏è Delete</button>
            </td>
          `;

          table.appendChild(row);
        });
      });
    }

    function save(key) {
      const steps = parseInt(document.getElementById(`steps-${key}`).value);
      const enabled = document.getElementById(`enabled-${key}`).checked;
      db.ref("walkathon/" + key).update({ steps, enabled })
        .then(() => {
          alert("Saved successfully!");
          loadLeaderboard();
        });
    }

    function remove(key) {
      if (confirm("Are you sure you want to delete this entry?")) {
        db.ref("walkathon/" + key).remove().then(() => loadLeaderboard());
      }
    }
  </script>
</body>
</html>
